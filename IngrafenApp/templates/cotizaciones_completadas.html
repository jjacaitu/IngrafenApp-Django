{% extends "base.html" %}
{% block content %}
<div class="container">
  <form enctype="multipart/form-data" method="POST">
    {% csrf_token %}
  <input type="text" id="parametro" name="parametro" value="" style="display:none" placeholder="Buscar por:">
  <select id="cl" name="cl" style="display:none">
    {% for clientes in clientes_creados %}
    <option value="{{ clientes.nombre }}">{{ clientes.nombre }}</option>
{% endfor %}
  </select>
  <select id="tr" class="opciones_trabajos" name="tr" style="display:none">
    {% for trabajos in trabajos_creados %}
    <option value="{{ trabajos.trabajo }}">{{ trabajos.trabajo }}</option>
{% endfor %}
  </select>
  <select id="cot" class="cotizadores" name="cot" style="display:none">
    {% for cotizador in cotizadores %}
    <option value="{{ cotizador.username }}">{{ cotizador.username }}</option>
{% endfor %}
  </select>
  <select id="ven" class="vendedores" name="ven" style="display:none">
    {% for vendedor in vendedores %}
    <option value="{{ vendedor.username }}">{{ vendedor.username }}</option>
{% endfor %}
  </select>
  <select  class="seleccion" name="seleccion" onchange="filtros_busqueda(this)">
    <option value="Todo">Todo</option>
    <option value="Cliente">Cliente</option>
    <option value="Trabajo">Tipo de trabajo</option>
    <option value="Solicitud"># Solicitud</option>
    <option value="Promocion">Nombre de promocion</option>
    {% if user.categoria == "ADM" %}
    <option value="Vendedor">Vendedor</option>
    <option value="Cotizador">Cotizador</option>
    {% endif %}

  </select>
  <label for="desde">DESDE:</label>

  <input id="desde" type="date" name="desde" value="">
  <label for="hasta">HASTA:</label>
  <input id="hasta" type="date" name="hasta" value="">
  <input type="submit" name="buscar" class="btn btn-primary" value="BUSCAR">
</div>

{% if ver == False %}
<h2>COTIZACIONES COMPLETADAS ENCONTRADAS:</h2>
<div class="">


<table class="table table-striped table-bordered">
<thead class="thead-dark">


    <th># SOLICITUD</th>
  <th>VENDEDOR</th>
  <th>CLIENTE</th>
  <th>PROMOCION</th>
  <th>MATERIAL</th>
  <th>TIPO DE TRABAJO</th>
  <th>CANTIDAD</th>
  <th>MEDIDA</th>
  <th>TIPO DE IMPRESION</th>
  <th>FECHA SOLICITADA</th>
  <th>FECHA COTIZADA</th>
  <th>COTIZADOR</th>
  <th># COTIZACION</th>
  <th>BOTON</th>
</thead>
{% for cotizacion in cotizaciones_completadas %}
{% if cotizaciones.vendedor == user.username or user.categoria == "COT" or user.categoria == "ADM" %}
<tr>

  <form enctype="multipart/form-data" method="POST">
    {% csrf_token %}

  <td name="numero">{{ cotizacion.num_solicitud }} </td>
  <td>{{ cotizacion.vendedor }} </td>
  <td>{{ cotizacion.nombre_cliente }} </td>
  <td>{{ cotizacion.trabajo}}</td>
  <td>{{ cotizacion.material }} </td>
  <td>{{ cotizacion.tipo_trabajo }} </td>
  <td>{{ cotizacion.cantidad }} </td>
  <td>{{ cotizacion.medida_ancho }} x {{ cotizacion.medida_alto }} </td>
  <td>{{ cotizacion.impresion }}</td>
  <td>{{ cotizacion.fecha_solicitada }}</td>
  <td>{{ cotizacion.fecha_completada }}</td>
  <td>{{ cotizacion.cotizador }}</td>
  <td>{{ cotizacion.numero_cotizacion }}</td>

  <td class="celda_boton"> <input type="submit" name="ver" value="ver cotizacion" class="btn btn-primary"></td>
  <input type="hidden" name="cot_ver" value="{{ cotizacion.num_solicitud }}">
  </tr>
  </form>
  {% endif %}
  {% endfor %}

</table>



</form>
</div>
<div class="container">


<div class="pagination" >

    <span class="step-links">
        {% if cotizaciones_completadas.has_previous %}
            <a href="?page=1"> <button type="button" class="btn btn-primary">first</button></a>
            <a href="?page={{ cotizaciones_completadas.previous_page_number }}"><button type="button" class="btn btn-primary">previous</button></a>
        {% endif %}

        <span class="current" style="font-weight:bold">
            Pagina {{ cotizaciones_completadas.number }} de {{ cotizaciones_completadas.paginator.num_pages }}
        </span>

        {% if cotizaciones_completadas.has_next %}
            <a href="?page={{ cotizaciones_completadas.next_page_number }}"><button type="button" class="btn btn-primary">next</button></a>
            <a href="?page={{ cotizaciones_completadas.paginator.num_pages }}"><button type="button" class="btn btn-primary">last</button></a>
        {% endif %}

    </span>
</div>
</div>
{% elif ver == True %}

<div class="container">


{% for cotizacion in cotizacion_buscada %}
<h2>Solicitud de cotizacion #{{cotizacion.num_solicitud}} Completada por: {{ cotizacion.cotizador }}</h2>
<table class="table table-bordered solido">
  <tr >
    <td> <label for="">Fecha solicitada:</label> </td>
    <td> {{ cotizacion.fecha_solicitada }} </td>
    <td> <label for="">Fecha completada:</label> </td>
    <td>{{ cotizacion.fecha_completada }}</td>
  </tr>
  <tr>
    <td><label for="">Cliente:</label></td>
<td>{{ cotizacion.nombre_cliente }}</td>
<td> <label for="">Nombre de promocion: </label></td>
<td>{{ cotizacion.trabajo }}</td>

  </tr>
<tr>
  <td><label for="">Tipo de trabajo:</label></td>
  <td>{{ cotizacion.tipo_trabajo }}
</td>

  <td><label for="">Cantidad:</label></td>
  <td>{{ cotizacion.cantidad }}</td>


  </tr>
  <tr>
    <td> <label for="">Medida:</label> </td>
    <td> {{ cotizacion.medida_alto }} <strong>X </strong>{{ cotizacion.medida_ancho }}</td>
    <td><label for="">Material:</label></td>
  <td>{{ cotizacion.material }}</td>

  </tr>
  {% if cotizacion.material_interiores != none %}
  <tr>


      <td> <label for="">Medida hojas interiores:</label> </td>
      <td> {{ cotizacion.medida_alto_interiores }} <strong>X </strong>{{ cotizacion.medida_ancho_interiores }}</td>
      <td><label for="">Material hojas interiores:</label></td>
      <td>{{ cotizacion.material_interiores }}</td>

  </tr>
  {% endif %}
  <tr>
    <td> <label for="">Tipo de impresion:</label> </td>
    <td> {{ cotizacion.impresion }} </td>
    <td colspan="2" rowspan="3">  <img src="{{ cotizacion.imagen.url }}" alt="Sin imagen adjunta"> </td>
  </tr>
  <tr>
    <td> <label for="">Troquelado:</label> </td>
    <td> {{ cotizacion.troquelado }} </td>
  </tr>
  <tr>
    <td> <label for="">UV:</label> </td>
    <td> {{ cotizacion.uv }} </td>
  </tr>
  <tr>
    <td> <label for="">laminado: </label> </td>
    <td> {{ cotizacion.laminado }} </td>
    <td colspan="2"> <textarea name="detalles" rows="5" cols="60" placeholder="Sin detalles adicionales" readonly>{{ cotizacion.detalles }}</textarea> </td>
  </tr>
</table>
{% endfor %}
<div class="container">
  <input type="submit" name="regresar" value="REGRESAR" class="btn btn-primary" >

</div>
{% endif %}

</div>

{% endblock %}
